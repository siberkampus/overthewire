{{define "content"}}
<div class="user-form-page">
    <!-- Header -->
    <div class="form-header">
        <div>
            <h2><i class="fas {{if .User.ID}}fa-edit{{else}}fa-user-plus{{end}}"></i>
                {{if .User.ID}}Kullanıcı Düzenle{{else}}Yeni Kullanıcı Ekle{{end}}</h2>
            <p>{{if .User.ID}}Kullanıcı bilgilerini güncelleyin{{else}}Platforma yeni bir kullanıcı ekleyin{{end}}</p>
        </div>
        <a href="/admin/users" class="btn-secondary">
            <i class="fas fa-arrow-left"></i> Geri Dön
        </a>
    </div>

    <!-- Form -->
    <form method="POST" action="/admin/api/users{{if .User.ID}}/{{.User.ID}}{{end}}" 
          enctype="multipart/form-data" class="user-form">
        
        <div class="form-grid">
            <!-- Sol Kolon - Kullanıcı Bilgileri -->
            <div class="form-left">
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-user-circle"></i> Kullanıcı Bilgileri
                    </h3>

                    <div class="form-group">
                        <label>Kullanıcı Adı <span class="required">*</span></label>
                        <input type="text" name="username" value="{{.User.Username}}" required 
                               placeholder="johndoe">
                    </div>

                    <div class="form-group">
                        <label>Email <span class="required">*</span></label>
                        <input type="email" name="email" value="{{.User.Email}}" required 
                               placeholder="john@example.com">
                    </div>

                    <div class="form-group">
                        <label>Ad Soyad</label>
                        <input type="text" name="fullname" value="{{.User.FullName}}" 
                               placeholder="John Doe">
                    </div>

                    <div class="form-row">
                        <div class="form-group half">
                            <label>Şifre {{if not .User.ID}}<span class="required">*</span>{{end}}</label>
                            <input type="password" name="password" {{if not .User.ID}}required{{end}} 
                                   placeholder="••••••••">
                            {{if .User.ID}}
                            <small>Boş bırakırsanız değişmez</small>
                            {{end}}
                        </div>

                        <div class="form-group half">
                            <label>Şifre Tekrar</label>
                            <input type="password" name="confirm_password" 
                                   placeholder="••••••••">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-address-card"></i> Profil Bilgileri
                    </h3>

                    <div class="form-group">
                        <label>Profil Resmi</label>
                        <div class="avatar-upload">
                            {{if .User.Avatar}}
                            <img src="{{.User.Avatar}}" alt="Avatar" class="avatar-preview">
                            {{else}}
                            <div class="avatar-placeholder">
                                <i class="fas fa-user"></i>
                            </div>
                            {{end}}
                            <input type="file" name="avatar" accept="image/*" id="avatarInput">
                            <button type="button" class="btn-upload" onclick="document.getElementById('avatarInput').click()">
                                <i class="fas fa-camera"></i> Resim Seç
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Ülke</label>
                        <select name="country">
                            <option value="">Seçiniz</option>
                            <option value="TR" {{if eq .User.Location "TR"}}selected{{end}}>Türkiye</option>
                            <option value="US" {{if eq .User.Location "US"}}selected{{end}}>Amerika</option>
                            <option value="GB" {{if eq .User.Location "GB"}}selected{{end}}>İngiltere</option>
                            <option value="DE" {{if eq .User.Location "DE"}}selected{{end}}>Almanya</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Web Sitesi</label>
                        <input type="url" name="website" value="{{.User.Website}}" 
                               placeholder="https://example.com">
                    </div>

                    <div class="form-group">
                        <label>Biyografi</label>
                        <textarea name="bio" rows="3" placeholder="Kendinizden bahsedin...">{{.User.Bio}}</textarea>
                    </div>
                </div>
            </div>

            <!-- Sağ Kolon - Hesap Ayarları -->
            <div class="form-right">
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-shield-alt"></i> Hesap Durumu
                    </h3>

                    <div class="toggle-group">
                        <div class="toggle-item">
                            <span>Hesap Aktif</span>
                            <label class="switch">
                                <input type="checkbox" name="is_active" {{if .User.IsActive}}checked{{end}}>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <span>VIP Üye</span>
                            <label class="switch">
                                <input type="checkbox" name="is_vip" {{if .User.IsVIP}}checked{{end}}>
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <span>Email Doğrulanmış</span>
                            <label class="switch">
                                <input type="checkbox" name="email_verified" {{if .User.EmailVerified}}checked{{end}}>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                {{if .User.ID}}
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-chart-line"></i> İstatistikler
                    </h3>

                    <div class="stats-list">
                        <div class="stat-item">
                            <span class="stat-label">Puan</span>
                            <span class="stat-value">{{.User.Points}}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Çözüm Sayısı</span>
                            <span class="stat-value">{{.User.SolvedCount}}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Son Giriş</span>
                            <span class="stat-value">{{.User.LastLogin.Format "02.01.2006 15:04"}}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Kayıt Tarihi</span>
                            <span class="stat-value">{{.User.CreatedAt.Format "02.01.2006"}}</span>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-exclamation-triangle"></i> Tehlikeli Bölge
                    </h3>

                    <div class="danger-zone">
                        <p>Bu işlemler geri alınamaz!</p>
                        <button type="button" class="btn-danger" onclick="resetPassword({{.User.ID}})">
                            <i class="fas fa-key"></i> Şifre Sıfırla
                        </button>
                        <button type="button" class="btn-danger" onclick="deleteUser({{.User.ID}})">
                            <i class="fas fa-trash"></i> Kullanıcıyı Sil
                        </button>
                    </div>
                </div>
                {{end}}
            </div>
        </div>

        <!-- Form Butonları -->
        <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="history.back()">
                İptal
            </button>
            <button type="submit" class="btn-primary">
                <i class="fas fa-save"></i> 
                {{if .User.ID}}Değişiklikleri Kaydet{{else}}Kullanıcı Oluştur{{end}}
            </button>
        </div>
    </form>
</div>

<style>
    .user-form-page {
        max-width: 1200px;
        margin: 0 auto;
    }

    .form-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .form-header h2 {
        font-family: 'Share Tech Mono', monospace;
        color: #00ff9d;
        margin-bottom: 0.3rem;
    }

    .btn-secondary {
        padding: 0.8rem 1.5rem;
        background: transparent;
        border: 1px solid #2a3a4a;
        border-radius: 8px;
        color: #b0b0b0;
        text-decoration: none;
        transition: 0.3s;
    }

    .btn-secondary:hover {
        border-color: #00ff9d;
        color: #00ff9d;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 2rem;
    }

    .form-section {
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid #2a3a4a;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .section-title {
        font-family: 'Share Tech Mono', monospace;
        color: #00ff9d;
        margin-bottom: 1.5rem;
        font-size: 1.1rem;
    }

    .section-title i {
        margin-right: 0.5rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #b0b0b0;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
        width: 100%;
        padding: 0.8rem 1rem;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid #2a3a4a;
        border-radius: 5px;
        color: #e0e0e0;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
        outline: none;
        border-color: #00ff9d;
    }

    .form-group small {
        display: block;
        color: #6a7a8a;
        font-size: 0.7rem;
        margin-top: 0.3rem;
    }

    .form-row {
        display: flex;
        gap: 1rem;
    }

    .half {
        flex: 1;
    }

    .required {
        color: #ff5f56;
    }

    .avatar-upload {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
    }

    .avatar-preview {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        border: 3px solid #00ff9d;
    }

    .avatar-placeholder {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: #1a1f2f;
        border: 2px dashed #2a3a4a;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: #2a3a4a;
    }

    .btn-upload {
        padding: 0.5rem 1rem;
        background: transparent;
        border: 1px solid #00ff9d;
        border-radius: 5px;
        color: #00ff9d;
        cursor: pointer;
    }

    .toggle-group {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .toggle-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #2a3a4a;
        transition: .3s;
        border-radius: 24px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: .3s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: #00ff9d;
    }

    input:checked + .slider:before {
        transform: translateX(26px);
    }

    .stats-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .stat-item {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid #2a3a4a;
    }

    .stat-label {
        color: #b0b0b0;
    }

    .stat-value {
        font-family: 'Share Tech Mono', monospace;
        color: #00ff9d;
    }

    .danger-zone {
        border: 1px solid #ff5f56;
        border-radius: 8px;
        padding: 1rem;
        text-align: center;
    }

    .danger-zone p {
        color: #ff5f56;
        margin-bottom: 1rem;
    }

    .btn-danger {
        width: 100%;
        padding: 0.8rem;
        background: transparent;
        border: 1px solid #ff5f56;
        border-radius: 5px;
        color: #ff5f56;
        cursor: pointer;
        margin-bottom: 0.5rem;
        transition: 0.3s;
    }

    .btn-danger:hover {
        background: #ff5f56;
        color: #fff;
    }

    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        margin-top: 2rem;
    }

    .btn-primary {
        padding: 1rem 2rem;
        background: linear-gradient(45deg, #00ff9d, #00b86e);
        border: none;
        border-radius: 8px;
        color: #0a0f0f;
        font-weight: 600;
        cursor: pointer;
    }

    @media (max-width: 1024px) {
        .form-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<script>
    function resetPassword(id) {
        if (confirm('Kullanıcının şifresini sıfırlamak istediğinize emin misiniz?')) {
            fetch(`/admin/api/users/${id}/reset-password`, { method: 'POST' })
                .then(response => response.json())
                .then(data => alert(`Yeni şifre: ${data.password}`));
        }
    }

    function deleteUser(id) {
        if (confirm('Bu kullanıcıyı silmek istediğinize emin misiniz? Bu işlem geri alınamaz!')) {
            fetch(`/admin/api/users/${id}`, { method: 'DELETE' })
                .then(() => window.location.href = '/admin/users');
        }
    }
</script>
{{end}}